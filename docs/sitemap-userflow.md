# 🗺️ コトリの株ノート サイトマップ・ユーザーフロー設計

## 📱 サイトマップ

### 基本ページ構成
```
📱 コトリの株ノート
├── 🏠 ホーム（銘柄検索）
│   ├── 🔍 検索バー（オートサジェスト）
│   ├── 📝 最近の検索履歴
│   └── 🌟 人気銘柄（クイックアクセス）
│
├── 📊 チャート詳細ページ
│   ├── 📈 メインチャート（Lightweight Charts）
│   ├── ⚙️ 期間切替（1W/1M/3M/6M/1Y）
│   ├── 📊 テクニカル指標（SMA/MACD/RSI/出来高）
│   ├── 🤖 AI解説セクション
│   └── 🔖 ブックマーク機能
│
├── 💡 おすすめ銘柄ページ
│   ├── 🏢 業種別フィルタ
│   ├── 💰 条件別フィルタ（高配当/成長株/安定株）
│   └── 📋 おすすめリスト
│
├── 📚 履歴・ユーザー管理
│   ├── 🕐 検索履歴（最大100件）
│   ├── 👤 ユーザープロフィール
│   └── 🔓 ログアウト機能
│
├── ⚙️ 設定ページ（MVP版簡素化）
│   ├── 🎨 テーマ切替（ライト/ダーク）
│   ├── 👤 ユーザー情報変更
│   └── 📱 基本表示設定
│
├── 🔐 認証ページ
│   ├── 📝 ユーザー登録
│   ├── 🔑 ログイン
│   └── 📧 パスワードリセット
│
└── 📜 法的文書
    ├── ⚖️ 利用規約
    ├── 🛡️ 免責事項
    └── 🔒 プライバシーポリシー
```

## 🎯 ユーザーフロー設計

### 1. 初回訪問者フロー（未登録）
```
開始
│
├── アプリアクセス
│   ├── ランディングページ表示
│   ├── サービス紹介
│   └── 「30秒で始める」ボタン
│
├── ユーザー登録画面
│   ├── メールアドレス入力
│   ├── パスワード設定
│   ├── [登録] ボタン
│   └── 「既にアカウントをお持ちの方」→ログイン
│
├── メール認証
│   ├── 認証メール送信
│   ├── メール内リンククリック
│   └── アカウント有効化
│
├── 初回ログイン
│   ├── ウェルカムメッセージ
│   ├── 簡単なチュートリアル
│   └── ホーム画面へ
│
└── 全機能利用開始
    ├── 無制限銘柄検索
    ├── AI解説利用（1日10回まで）
    └── 検索履歴保存
```

### 2. リピーターフロー（登録済み）
```
開始
│
├── アプリアクセス
│   ├── 自動ログイン（JWT認証）
│   └── ホーム画面（即座に表示）
│
├── 履歴から選択
│   ├── 最近の検索履歴（100件）
│   ├── データベース保存済み
│   └── ワンタップアクセス
│
├── チャート詳細画面
│   ├── キャッシュ利用で高速表示
│   ├── ユーザー設定の期間・指標
│   └── AI解説（1日10回まで）
│
└── 日常的な利用
    ├── 制限内での検索・分析
    ├── 基本設定カスタマイズ
    └── 履歴参照
```

### 3. ユーザー認証フロー
```
開始
│
├── ログインページ
│   ├── メールアドレス入力
│   ├── パスワード入力
│   ├── [ログイン] ボタン
│   └── 「パスワードを忘れた方」
│
├── パスワードリセット
│   ├── メールアドレス入力
│   ├── リセットメール送信（トークン有効期限: 1時間）
│   ├── メール内リンククリック
│   ├── 新パスワード設定
│   └── セキュリティ機能:
│       ├── リセット試行回数制限（5回/時間）
│       ├── トークン1回限り使用
│       └── 使用後即座に無効化
│
├── 認証成功
│   ├── JWT トークン発行
│   ├── ローカルストレージ保存
│   └── ホーム画面へリダイレクト
│
└── セッション管理
    ├── Access Token: 1時間（自動更新）
    ├── Refresh Token: 7日間
    ├── トークン有効期限チェック
    └── 必要時に再認証
```

## 🔄 画面遷移パターン

### ナビゲーション設計
```
📱 スマホ対応ナビゲーション
├── 下部固定タブ（ログイン後）
│   ├── 🏠 ホーム
│   ├── 📊 チャート
│   ├── 💡 おすすめ
│   ├── 📚 履歴
│   └── ⚙️ 設定
│
├── 検索機能（常時アクセス）
│   ├── 🔍 ヘッダー検索バー
│   ├── 履歴からの候補表示
│   └── オートサジェスト機能
│
├── ユーザーメニュー
│   ├── 👤 プロフィール
│   ├── 🔓 ログアウト
│   └── 📧 メール設定変更
│
└── サイドメニュー
    ├── 📜 利用規約
    ├── 🔒 プライバシー
    └── 📞 お問い合わせ
```

## 📊 インタラクション設計

### 検索機能
```
検索バー
├── リアルタイム検索
│   ├── 2文字以上でオートサジェスト
│   ├── 銘柄コード（4桁）自動認識
│   └── 企業名での部分一致検索
│
├── 検索結果表示
│   ├── 銘柄コード + 企業名
│   ├── 現在株価 + 騰落率
│   └── 業種・市場情報
│
└── 検索履歴
    ├── 最大100件保存
    ├── 日付順ソート
    └── 削除・編集機能
```

### チャート操作
```
チャート画面
├── 期間切替
│   ├── タブ式UI（1W/1M/3M/6M/1Y）
│   ├── スワイプ操作対応
│   └── 長押しでカスタム期間
│
├── 指標表示
│   ├── ON/OFF切替ボタン
│   ├── 設定値調整スライダー
│   └── 複数指標同時表示
│
└── AI解説
    ├── 展開・収納ボタン
    ├── 解説文のコピー機能
    └── 更新ボタン（再生成）
```

## 🎨 レスポンシブデザイン

### 画面サイズ対応
```
📱 スマートフォン（375px〜）
├── 縦向き表示メイン
├── 大きめタップエリア（48px以上）
├── スクロール操作中心
└── 下部固定ナビゲーション

📲 タブレット（768px〜）
├── 横向き表示対応
├── サイドバーナビゲーション
├── 複数カラム表示
└── チャート拡大表示

💻 デスクトップ（1024px〜）
├── 横向きレイアウト
├── マウス操作最適化
├── キーボードショートカット
└── 複数画面表示
```

## 🔄 エラーハンドリング・代替フロー

### エラー状況別対応
```
データ取得エラー
├── 株価API障害
│   ├── キャッシュデータ表示
│   ├── 「データ更新中」表示
│   └── 手動更新ボタン
│
├── AI API制限
│   ├── 「解説生成中」表示
│   ├── 「混雑のためお待ちください」
│   └── 基本的な指標説明表示
│
└── 通信エラー
    ├── オフライン検出
    ├── 「接続確認してください」
    └── 再接続ボタン
```

## 📝 ユーザビリティ配慮

### アクセシビリティ
- **色覚異常対応**: 色だけでなく形・文字での情報提供
- **フォントサイズ**: 最小14px、拡大対応
- **コントラスト**: WCAG AA基準準拠
- **音声読み上げ**: alt属性、aria-label適切設定

### 初心者向け配慮
- **用語説明**: 専門用語に解説リンク
- **ガイダンス**: 初回利用時のチュートリアル
- **視覚的フィードバック**: 操作結果の明確な表示
- **エラー回避**: 誤操作防止のUI設計

---

## 🔐 認証・セキュリティ設計

### ユーザー登録障壁を下げる工夫
```
🎨 登録促進UI:
- 「30秒で始められる」明確なメッセージ
- 必要な情報はメールアドレスのみ
- メールアドレス認証のみ（MVP版）
- 登録後すぐに全機能利用可能

✨ 価値提案:
- 「完全無料で AI 株価分析」
- 「広告なしでストレスフリー」
- 「検索履歴でポートフォリオ管理」
- 「投資初心者にやさしい解説」
```

### セキュリティ対策
```
🔒 認証セキュリティ:
- パスワードハッシュ化（bcrypt）
- JWT トークン（Access: 1時間、Refresh: 7日間）
- メール認証必須
- レート制限（ログイン試行制限）

🛡️ データ保護:
- 最小限の個人情報収集
- GDPR 準拠のプライバシー設計
- データ暗号化（保存時・転送時）
- 定期的なセキュリティ監査
```

---

**最終更新**: 2025-01-15
**バージョン**: 2.0（ユーザー登録必須版）